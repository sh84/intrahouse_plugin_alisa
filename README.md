## Интеграция с Яндекс

### Главная вводная
Для связи с нашим плагином в IntraHouse нужно иметь рабочий домен и ssl сертификат к нему, и настроить проброс (проксирование) запросов от Яндекса к данному плагину (на порт указанный в настроqйках плагина).

### Установка

Используем архив intrahouse_plugin_alisa.zip и устанавливаем плагин как описано в https://docs.intrahouse.ru/ru/plugin-install#%D1%80%D0%B5%D0%B7%D0%B5%D1%80%D0%B2%D0%BD%D1%8B%D0%B9-%D1%81%D0%BF%D0%BE%D1%81%D0%BE%D0%B1-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BF%D0%BB%D0%B0%D0%B3%D0%B8%D0%BD%D0%B0.

### Настройка

Пользуемся возможностью заводить произвольные приватные навыки в [ЯндексДиалогах](https://dialogs.yandex.ru/developer): **Создать диалог** -> **Умный дом**.
В приватном режиме он будет видимым только себе (и конкретным указанным пользователям), не нужно проходить модерацию.

*Название* - произвольное.  
В *Endpoint URL* заносим свой урл (``https://мой_домен/`` - там должен быть проброс https запросов к своему серверу InraHouse.
*Тип доступа*: Приватный, *Официальный навык*: нет, *Имя разработчика* - произвольное, *Описание* - произвольное.
В вкладке **Связка аккаунтов**:
*Идентификатор приложения*: что угодно, например alisa_intrahouse.  
*Секрет приложения*: указать такой же, как в поле **Oauth cекрет приложения** настроек плагина (т.е. придумать и заполнить одинаково).  
*URL авторизации*: ``https://мой_домен/oauth/authorize``  
*URL для получения токена*: ``https://мой_домен/oauth/token``

**Сохраняем, публикуем.**

На главной странице созданного навыка умного дома будет поле "Идентификатор диалога". Необходимо скопировать его значение в поле **Идентификатор диалога** настроек плагина.

**Последний шаг настройки.**

Использовать API сервиса уведомлений (что бы наш плагин мог сам отправлять данные  в Яндекс) можно только от имени пользователя Яндекса, который создал навык в Диалогах. На этой странице есть ссылка для получения кода для обращения к api яндекса от имени пользователя: https://yandex.ru/dev/dialogs/smart-home/doc/reference-alerts/resources-alerts.html.
Ищем текст `Для этого нужно получить OAuth-токен для Диалогов`.  
Полученный код сохранить в поле **OAuth-токен пользователя** настроек плагина.

После этого умный дом с придуманным названием появится в списке умных домов приложения управления умным дома Яндекса. Дальше все аналогично любому другому умному дому (например Xiaomi).

## Подключаем свой умный в приложении Яндекса

Нажимаем "+", "Устройство умного дома", "название своего умного дома", "Привязать к Яндексу" - подтверждаем.

В IntraHouse для устройств, которые нужно прокинуть в Яндекс идем во вкладку "Интеграции", "Yandex Alisa", ставим галку "Включить в интеграцию".
При этом нужно заполнить "Название для Алисы" и "Комната". Эти два параметра появятся при добавлении устройства в Яндекс умный дом (при добавлении их можно будет изменить).
Например, присвоив название "свет" и комната "спальня" можно будет говорить "включи свет в спальне" и т.п.
Сама привязка конкретных умений и свойств Яндекс умного дома для каждого устройства к свойствам и обработчикам IntraHouse делается либо в каждом устройстве, либо в типе устройства.
